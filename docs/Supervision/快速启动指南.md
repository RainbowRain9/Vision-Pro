# YOLOvision Pro + Supervision 快速启动指南

## 概述
本指南将帮助您快速在 YOLOvision Pro 中集成 Supervision.roboflow.com，实现增强的数据可视化和分析功能。

## 1. 环境准备

### 1.1 安装 Supervision
```bash
# 安装 Supervision
pip install supervision>=0.18.0

# 验证安装
python scripts/validation/test_supervision.py
```

### 1.2 系统要求
- Python >= 3.8
- OpenCV >= 4.6.0
- Matplotlib >= 3.3.0
- NumPy >= 1.20.0

## 2. 快速测试

### 2.1 运行集成测试
```bash
# 运行完整测试
python scripts/validation/test_supervision.py
```

### 2.2 运行演示脚本
```bash
# 使用 VisDrone 数据集演示
python scripts/demo/supervision_demo.py --visdrone data/visdrone_yolo

# 处理单张图像
python scripts/demo/supervision_demo.py --image path/to/image.jpg
```

## 3. 基本使用

### 3.1 在现有代码中使用
```python
import supervision as sv
from ultralytics import YOLO

# 初始化
model = YOLO('yolov8s.pt')
box_annotator = sv.BoxAnnotator()
label_annotator = sv.LabelAnnotator()

# 检测图像
results = model.predict('image.jpg')
result = results[0]

# 转换为 Supervision 格式
detections = sv.Detections(
    xyxy=result.boxes.xyxy.cpu().numpy(),
    confidence=result.boxes.conf.cpu().numpy(),
    class_id=result.boxes.cls.cpu().numpy().astype(int)
)

# 生成可视化
annotated_image = result.orig_img.copy()
annotated_image = box_annotator.annotate(scene=annotated_image, detections=detections)
annotated_image = label_annotator.annotate(scene=annotated_image, detections=detections)

# 保存结果
cv2.imwrite('result.jpg', annotated_image)
```

### 3.2 在训练中使用
```python
import supervision as sv
from ultralytics import YOLO

# 初始化监控器
metrics = sv.DetectionMetrics()

# 训练模型
model = YOLO('yolov8s.pt')
results = model.train(data='data/visdrone_yolo/data.yaml', epochs=10)

# 分析训练结果
# 这里可以添加更详细的训练监控代码
```

## 4. 高级功能

### 4.1 热力图生成
```python
heat_map_annotator = sv.HeatMapAnnotator()
heatmap = heat_map_annotator.annotate(scene=image, detections=detections)
```

### 4.2 性能指标分析
```python
metrics = sv.DetectionMetrics()
# 计算各种指标
```

### 4.3 批量处理
```python
import glob
from pathlib import Path

# 批量处理图像
image_files = glob.glob('data/visdrone_yolo/images/train/*.jpg')[:10]

for i, image_path in enumerate(image_files):
    results = model.predict(image_path)
    # 处理结果...
```

## 5. 集成到现有系统

### 5.1 修改 main.py
在 `main.py` 中添加 Supervision 支持：

```python
# 在 __init__ 方法中添加
self.supervision_enabled = False

# 添加 Supervision 加载方法
def load_supervision_wrapper(self):
    try:
        from scripts.modules.supervision.wrapper import SupervisionWrapper
        self.supervision_wrapper = SupervisionWrapper()
        self.supervision_enabled = True
        self.statusbar.showMessage("Supervision 集成已启用", 3000)
    except ImportError as e:
        QMessageBox.warning(self, "警告", f"无法加载 Supervision: {e}")
```

### 5.2 创建新脚本
在 `scripts/` 目录下创建新的 Supervision 相关脚本：

```bash
scripts/
├── supervision/
│   ├── __init__.py
│   ├── wrapper.py          # Supervision 包装器
│   ├── visualizer.py       # 可视化工具
│   ├── analyzer.py         # 分析工具
│   └── monitor.py          # 监控工具
└── demo/
    └── supervision_demo.py  # 演示脚本
```

## 6. 常见问题

### 6.1 依赖冲突
**问题**: Supervision 与现有包版本冲突
**解决**: 使用虚拟环境
```bash
# 创建虚拟环境
python -m venv supervision_env
source supervision_env/bin/activate  # Linux/Mac
# 或
supervision_env\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt
pip install supervision
```

### 6.2 性能问题
**问题**: Supervision 功能影响性能
**解决**: 
- 使用缓存
- 异步处理
- 减少实时更新频率

### 6.3 内存问题
**问题**: 处理大量图像时内存不足
**解决**:
- 分批处理
- 及时释放内存
- 使用生成器

## 7. 下一步

1. **阅读完整方案**: 查看 `docs/Supervision集成可行性方案.md`
2. **运行测试**: 确保所有组件正常工作
3. **开始开发**: 根据需求实现具体功能
4. **优化性能**: 根据使用情况优化性能
5. **用户反馈**: 收集用户反馈并改进

## 8. 资源链接

- [Supervision 官方文档](https://supervision.roboflow.com/)
- [YOLOvision Pro 文档](../README.md)
- [VisDrone 数据集](https://github.com/VisDrone/VisDrone2019)

## 9. 技术支持

如果遇到问题，请：
1. 检查此指南的常见问题部分
2. 运行测试脚本诊断问题
3. 查看详细的可行性方案文档
4. 联系技术支持

---

**提示**: 建议先在小规模数据上测试，确认功能正常后再处理完整数据集。